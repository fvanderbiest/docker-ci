database:
    build: ./postgresql
    expose:
        - "5432"
    volumes:
        - ~/docker/volumes/georchestra/postgresql_logs:/var/log/postgresql
    # we'll see data volumes later on
    # https://docs.docker.com/userguide/dockervolumes/
    #    - ~/docker/volumes/georchestra/postgresql_etc:/etc/postgresql
    #    - ~/docker/volumes/georchestra/postgresql_data:/var/lib/postgresql

ldap:
    build: ./openldap
    expose:
        - "389"
    # we'll see data volumes later on
    # https://docs.docker.com/userguide/dockervolumes/
    #volumes:
    #    - ~/docker/volumes/georchestra/openldap_data:/etc/ldap/slapd.d

apache:
    build: ./apache
    ports:
        - "80:80"
        - "443:443"
    volumes:
        - ~/docker/volumes/georchestra/apache_logs:/tmp
    links:
        - proxycas:proxy_host

proxycas:
    build: ./proxycas
    privileged: true
    ports:
        - "8180:8180"
    links:
        - ldap:ldap_host
        #~ - mapfishapp:mapfishapp_host
        #~ - ldapadmin:ldapadmin_host
        - catalogapp:catalogapp_host
        #~ - geoserver:geoserver_host
    volumes:
        - ~/docker/volumes/georchestra/proxycas_logs:/tmp

# Broken build for now, see https://github.com/georchestra/georchestra/issues/857
#~ mapfishapp:
    #~ build: ./mapfishapp
    #~ privileged: true
    #~ ports:
        #~ - "8280"
    #~ links:
        #~ - database:postgresql_host
    #~ volumes:
        #~ - ~/docker/volumes/georchestra/mapfishapp_logs:/tmp

geoserver:
    build: ./geoserver
    privileged: true
    expose:
        - "8380"
    volumes:
        - ~/docker/volumes/georchestra/geoserver_logs:/tmp
        
ldapadmin:
    build: ./ldapadmin
    privileged: true
    expose:
        - "8281"
    links:
        - ldap:ldap_host
        - database:postgresql_host
    volumes:
        - ~/docker/volumes/georchestra/ldapadmin_logs:/tmp

catalogapp:
    build: ./catalogapp
    privileged: true
    ports:
        - "8282:8282"